@using Microsoft.AspNetCore.Identity
@using FitnessCenterReservationSystem.Models
@inject SignInManager<ApplicationUser> SignInManager

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>@ViewData["Title"] - Fitness Center</title>

    <!-- AdminLTE CSS -->
    <link rel="stylesheet" href="~/dist/css/adminlte.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" />

    @RenderSection("Styles", required: false)
</head>

<body class="@(SignInManager.IsSignedIn(User)
          ? "layout-fixed sidebar-expand-lg bg-body-tertiary"
          : "bg-body-tertiary pt-5")">

    <div class="app-wrapper">

        @if (SignInManager.IsSignedIn(User))
        {
            <!-- NAVBAR -->
            @await Html.PartialAsync("_Navbar")

            <!-- SIDEBAR -->
            @await Html.PartialAsync("_Sidebar")
        }
        else
        {
            <!-- PUBLIC NAVBAR -->
            @await Html.PartialAsync("_PublicNavbar")
        }

        <!-- MAIN CONTENT -->
        @if (SignInManager.IsSignedIn(User))
        {
            <main class="app-main">
                <div class="container-fluid pt-3">
                    @await Html.PartialAsync("_Notification")
                    @RenderBody()
                </div>
            </main>
        }
        else
        {
            <main>
                <div class="container pt-5">
                    @await Html.PartialAsync("_Notification")
                    @RenderBody()
                    @await Html.PartialAsync("_PublicFooter")
                </div>
            </main>
        }

    </div>

    <!-- ALERT AUTO HIDE -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            document.querySelectorAll(".alert").forEach(alert => {
                setTimeout(() => {
                    alert.style.transition = "opacity 0.5s ease";
                    alert.style.opacity = "0";
                    setTimeout(() => alert.remove(), 500);
                }, 2000);
            });
        });
    </script>

    <!-- JS FILES (ORDER IS IMPORTANT) -->
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/dist/js/adminlte.js"></script>

    <!-- SIDEBAR TREEVIEW STATE -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {

            const treeItems = document.querySelectorAll(".has-treeview");
            const openMenu = localStorage.getItem("openMenu");

            // Sayfa yüklenince açık menüyü geri aç
            if (openMenu) {
                const menu = document.querySelector(`[data-menu="${openMenu}"]`);
                if (menu) {
                    menu.classList.add("menu-open");
                    menu.querySelector(".nav-link").classList.add("active");
                }
            }

            // Menü tıklanınca state kaydet
            treeItems.forEach(item => {
                const link = item.querySelector(".nav-link");
                link.addEventListener("click", function () {
                    const key = item.getAttribute("data-menu");

                    if (item.classList.contains("menu-open")) {
                        localStorage.removeItem("openMenu");
                    } else {
                        localStorage.setItem("openMenu", key);
                    }
                });
            });

        });
    </script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
